<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Primary Meta Tags -->
    <meta name="description" content="WiFi thermostat for ESP32 & ESP8266 with smart boiler control, temperature regulation, and hysteresis. Supports DS18B20 sensor, OneWire interface, WebSocket, and JSON client.">
    <meta name="keywords" content="WiFi thermostat, ESP32 thermostat, ESP8266 thermostat, DS18B20 sensor, OneWire interface, relay control, automatic boiler control, temperature regulation, hysteresis, JSON client, web interface thermostat, NodeMCU, Wemos D1 Mini, boiler temperature control, microcontroller thermostat, Arduino Core 2.7.4, WiFi thermostat firmware, ESP32 DevKit, ESP8266-12E, temperature sensor, home automation, WebSocket thermostat, mDNS, UART thermostat, MIT License thermostat, DIY thermostat, PayPal support, thermostat source code, experimental thermostat firmware, Slovak language firmware, energy-efficient thermostat.">
    <title>WiFi Thermostat for ESP32 & ESP8266: Smart Boiler Control with Temperature Regulation and Hysteresis</title>
	<!-- Open Graph / Facebook -->
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://martinius96.github.io/WiFi-termostat/en/">
	<meta property="og:title" content="WiFi thermostat - ESP8266 / ESP32 - Webserver - boiler control with hysteresis">
	<meta property="og:description" content="Room thermostat designed on the Espressif platform - ESP8266 / ESP32. Thermostat for domestic heating with gas boiler control.">

	<!-- Twitter -->
	<meta property="twitter:card" content="summary_large_image">
	<meta property="twitter:url" content="https://martinius96.github.io/WiFi-termostat/en/">
	<meta property="twitter:title" content="WiFi thermostat - ESP8266 / ESP32 - Webserver - boiler control with hysteresis">
	<meta property="twitter:description" content="Room thermostat designed on the Espressif platform - ESP8266 / ESP32. Thermostat for domestic heating with gas boiler control">
	
	<link rel="icon" type="image/png" href="favicon.png">
	<link rel="sitemap" type="application/xml" title="Sitemap" href="../../sitemap.xml" />
	<meta name="google-site-verification" content="UwZZh2EXv3iWUAi_1Z0hLxVCz6ySJ4UdY_BPoLtejwo" />    	
	<meta property='fb:admins' content='100001242570317'>
    	<meta charset="utf-8">
    	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/arduino-light.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/arduino.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>    
			 <style>
  pre {
  counter-reset: line-numbering;
  background: #2c3e50;
  padding: 12px 0px 14px 0;
  color: #ecf0f1;
  line-height: 100%;
}

pre .line::before {
  content: counter(line-numbering);
  counter-increment: line-numbering;
  padding-right: 1em;
  /* space after numbers */
  padding-left: 8px;
  width: 1.5em;
  text-align: right;
  opacity: 0.5;
  color: white;
}
  </style>
		<style>
	#right {
  position: absolute;
  right: 0px;
}
	</style>
</head>
<body>
	<div class="container">
  		<div class="row">
    			<div class="col-sm-12">
<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="index.html">WiFi thermostat</a>
    </div>
    <ul class="nav navbar-nav">
      	<li class="active"><a href="index.html">Overview</a></li>
	<li><a href="zapojenie.html">Involvement</a></li>      
	<li class=""><a href="spustenie.html">Firmware</a></li>
  	<li><a href="json_client.html">JSON client</a></li>
      	<li><a href="kontakt.html">Contact</a></li>
<a href="../de/index.html"><img src="https://futbalovysen.sk/wp-content/uploads/germany.png" alt="Germany.png, 2,2kB" title="Germany" height="32" width="32"></a>	
<a href="../index.html"><img src="https://futbalovysen.sk/wp-content/uploads/slovakia.png" alt="Slovak flag.png, 2,2kB" title="Slovakia" height="32" width="32"></a>   
<li style="float: right; "><a href="https://martinius96.github.io/termostat-ethernet/en/" class="btn btn-danger" role="button" title="Zmeniť projekt na Ethernet termostat"><img src="https://i.imgur.com/6dW9TvK.png" width=16px height=16px> <font color="white">Ethernet thermostat</font></a></li>
</ul>
  </div>
</nav>  
<div class="alert alert-success">
	<strong>Project repository with machine codes: </strong><a href="https://github.com/martinius96/WiFi-termostat/">WiFi thermostat - the latest release compiled from the latest build of Arduino Core 2.7.4.</a>
</div>	
<div class="alert alert-danger">
	The WiFi_Thermostat and WiFi_Thermostat_mDNS firmware is available in English language for the ESP32 and ESP8266 microcontrollers (Espressif Systems). Experimental version of basic Thermostat firmware with manual output control is only available in the Slovak language.
</div>	
<div class="alert alert-info">
 	<strong>Support the WiFi thermostat project via PayPal. Support will allow you to add new features in the future and open the source code of the application: </strong><a href="https://www.paypal.com/paypalme/chlebovec" class="btn btn-primary" role="button">PayPal donate</a>
</div>	
<span class="label label-default">ESP8266</span>
<span class="label label-primary">ESP32</span>
<span class="label label-success">WiFi</span>
<span class="label label-info">DS18B20</span>
<span class="label label-warning">OneWire</span>
<span class="label label-danger">Dallas</span>
<span class="label label-default">HTML</span>
<span class="label label-primary">Webserver</span>
<span class="label label-success">WebSocket</span>
<span class="label label-info">JSON</span>
<span class="label label-warning">mDNS</span>	
<span class="label label-danger">UART</span>					
  <div class="row">
	<div class="col-sm-4"><center><img src="https://i.imgur.com/koSyFuW.png" width="128px" height="128px" style="border-radius: 50%;" alt="Control microcontroller NodeMCU v2 / v3 Lolin - ESP8266-12E / ESP8266-12F" title="Control microcontroller NodeMCU v2 / v3 Lolin - ESP8266-12E / ESP8266-12F"><br><b><a href="https://www.ebay.com/itm/252718027546">NodeMCU (ESP8266)</a></b></center></div>
	<div class="col-sm-4"><center><img src="https://i.imgur.com/FV9xi6K.png" width="128px" height="128px" style="border-radius: 50%;" alt="Control microcontroller Wemos D1 Mini - ESP8266-12E / ESP8266-12F" title="Control microcontroller Wemos D1 Mini - ESP8266-12E / ESP8266-12F"><br><b><a href="https://www.ebay.com/itm/254535886946">Wemos D1 / D1 Mini (ESP8266)</a></b></center></div>
	<div class="col-sm-4"><center><img src="https://i.imgur.com/BczG03b.png" width="128px" height="128px" style="border-radius: 50%;" alt="Control microcontroller ESP32 Devkit V1 - ESP-WROOM-32 / ESP32-S" title="Control microcontroller ESP32 Devkit V1 - ESP-WROOM-32 / ESP32-S"><br><b><a href="https://www.ebay.com/itm/254953129496">ESP32 DevKit</a></b></center></div></div>					
 <hr><center><h1>WiFi Thermostat - ESP8266 / ESP32</h1></center><hr>

  <section>
    <p style="text-align: justify;">
      The WiFi thermostat is a highly efficient system designed for microcontrollers from Espressif Systems, featuring seamless integration with ESP8266 (12E, 12F, Wemos D1 Mini, NodeMCU v2/v3) and ESP32 platforms. This system enables reliable WiFi connectivity, enabling easy access to configuration via an intuitive web interface.
      <strong>Note:</strong> ESP8266-01/ESP8266-01S and earlier microcontrollers are not compatible with the project due to limitations in firmware upload methods. ESP32 microcontrollers, including ESP32-WROOM-32, ESP-32S, and associated DevKits, are fully supported.
    </p>
  </section>

  <section>
    <h2>Hardware Requirements</h2>
    <ul>
      <li>ESP8266 / ESP32 microcontroller</li>
      <li>DS18B20 temperature sensor (OneWire interface)</li>
      <li>Relay: SRD-5VDC-SL-C / OMRON G3MB-202P for boiler switching (Active-LOW signal)</li>
    </ul>
  </section>

  <section>
    <h2>Web Interface Pages</h2>
    <ul>
      <li><strong>/</strong> - Root page displaying form, current relay output, target and current temperature, and hysteresis settings.</li>
      <li><strong>/action.html</strong> - Processes form data, updates EEPROM, and redirects to the root page.</li>
      <li><strong>/get_data.json</strong> - Shares temperature data in JSON format, suitable for third-party systems (e.g., MQTT brokers, home automation). </li>
      <li>Other system pages for control and configuration adjustments.</li>
    </ul>
  </section>

  <section>
    <h2>Sensor and Relay Details</h2>
    <p style="text-align: justify;">
      <strong>DS18B20 Sensor:</strong> This temperature sensor provides 12-bit resolution, offering accuracy in 0.0625 °C increments. The OneWire bus allows for fast data transmission (500-1000 ms).
    </p>
    <p style="text-align: justify;">
      <strong>Relay Options:</strong> The SRD-5VDC-SL-C relay can handle up to 10A at 230V AC (2300W). For DC circuits, it supports up to 300W. Alternatively, the OMRON G3MB-202P SSR is designed for AC circuits with non-inductive loads (up to 460W).
    </p>
  </section>

  <section>
    <h2>Features and Functionality</h2>
    <ul>
      <li>Automatic boiler control with real-time temperature adjustment and hysteresis</li>
      <li>Configurable target temperature and hysteresis</li>
      <li>Boiler ON/OFF control with automatic mode</li>
    </ul>

    <div class="alert alert-danger">
      <strong>Important:</strong> The automatic mode implementation is experimental and may have some limitations.
    </div>
    
    <p style="text-align: justify;">
      The thermostat can also serve as a WiFi thermometer when not controlling the boiler, providing temperature data without active heating control. It operates independently of the web interface every 10 seconds.
    </p>

    <img src="https://i.imgur.com/IDWLuOr.png" alt="Boiler control with hysteresis" title="Boiler ON/OFF control with hysteresis" style="max-width: 100%; height: auto;">
  </section>

  <section>
    <h2>Web Interface and User Experience</h2>
    <p style="text-align: justify;">
      The thermostat's web interface adapts for both desktop and mobile devices, ensuring a responsive and user-friendly experience. It uses Bootstrap CSS for optimal performance, reducing load on the microcontroller. The configuration is stored in EEPROM memory to persist settings after power outages, ensuring reliable operation.
    </p>
  </section>

  <section>
    <h2>Important Notes</h2>
    <p style="text-align: justify;">
      To prevent EEPROM wear, configuration data (reference temperature and hysteresis) are only updated when the form is submitted. The web page refreshes every 30 seconds to update the status, with a warning for users to save their changes before the page refresh.
    </p>
  </section>

  <section>
    <h2>Disclaimer</h2>
    <div class="alert alert-danger">
      <strong>Warning:</strong> The author of the WiFi thermostat is not responsible for any damage caused by improper installation or operation. The thermostat is provided under the MIT License.
    </div>
  </section>
<section>
  <h2>Main Page for Modifying Target Temperature and Hysteresis</h2>
  <p><strong>Example of Switched On Output:</strong></p>

  <div class="alert alert-info">
    <strong>Sample Data:</strong>
    <ul>
      <li><strong>Target Temperature:</strong> 22.75 °C</li>
      <li><strong>Hysteresis:</strong> 0.25 °C</li>
      <li><strong>Measured Temperature:</strong> 22.49 °C</li>
      <li><strong>Output Status:</strong> <span style="color: #27AE60;">ON</span></li>
    </ul>
    <hr>
    <p style="text-align: justify;">
      The thermostat activates the heating process when the measured temperature drops to 22.49 °C or lower. Once the temperature reaches 23.01 °C, the output is turned off, the signaling relay opens, and the gas boiler stops heating, initiating the cooling phase in the room.
      The thermostat remains inactive until the temperature falls to 22.49 °C or below, at which point a new heating cycle begins. This precise temperature regulation helps maintain the desired room temperature while optimizing energy efficiency and ensuring comfort.
    </p>
  </div>
</section>

</div>

<b>Main page for target temperature and hysteresis modification:</b>
<img src="https://i.imgur.com/dBXiDLN.png" style="display: block; max-width: 100%; height: auto;" alt="WiFi thermostat - Main overview with modification of target temperature and hysteresis" title="WiFi thermostat - Main overview with modification of target temperature and hysteresis">        			

<b>Processing of datas that user entered by HTML form:</b>
<img src="https://i.imgur.com/QaGCYGh.png" style="display: block; max-width: 100%; height: auto;" alt="WiFi thermostat - data processing from HTML form" title="WiFi thermostat - data processing from HTML form">        			

<b>JSON web server output in browser / client via websocket:</b>
<center><img src="https://i.imgur.com/iqxV12k.png" style="display: block; max-width: 100%; height: auto;" alt="WiFi termostat - JSON output" title="WiFi termostat - JSON output"></center>        		

<b>Output to UART monitor - system logic + set IP address, mDNS record:</b>
<center><img src="https://i.imgur.com/gWm9izE.png" style="display: block; max-width: 100%; height: auto;" alt="WiFi termostat - UART output with mDNS record, IP address of thermostat" title="WiFi termostat - UART output with mDNS record, IP address of thermostat"></center>        		
<hr><center><h4>Available libraries for microcontrollers (ESP)</h4></center><hr>
<div class="alert alert-danger">
	Library archive (.zip) expand to <strong>C:/Users/[User]/Documents/Arduino/libraries</strong>
</div>
<div class="table-responsive">   
<table class="table" style="border: 1px solid black;">
<thead>
<tr>
<th style="width: 25%">Library name</th>
<th style="width: 50%">Library function</th>
<th style="width: 25%">Download</th>
</tr>
</thead>
<tbody>
<tr>
<td style="width: 25%"><b>Dallas</b></td>
<td style="width: 50%">
<p style="text-align: justify;">
Library for ESP8266 and ESP32 microcontrollers.
It allows communication with the Dallas DS18B20 sensor on the OneWire bus. Possibility of communication after normal or parasitic connection. 
</p>
</td>
<td style="width: 25%"><a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/martinius96/termostat-ethernet/tree/master/src/dallas" class="btn btn-success" role="button">Download</a></td>
</tr>
<tr>
<td style="width: 25%"><b>WiFiManager</b></td>
<td style="width: 50%">
<p style="text-align: justify;">
Library for ESP8266 and ESP32 microcontrollers.
Creates an access point (AP) and Captive portal for configuring a WiFi thermostat on a home WiFi network.
</p>
</td>
<td style="width: 25%"><a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/martinius96/WiFi-termostat/tree/main/src/WiFiManager-0.16.0" class="btn btn-success" role="button">Download</a></td>
</tr>
<tr>
<td style="width: 25%"><b>DNS Server</b></td>
<td style="width: 50%">
<p style="text-align: justify;">
ESP32 microcontroller library.
Required for WiFiManager library to work properly.
</p>
</td>
<td style="width: 25%"><a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/martinius96/WiFi-termostat/tree/main/src/DNSServer---esp32-master" class="btn btn-success" role="button">Download</a></td>
</tr>
</tbody>
</table>
</div>
<hr><h2>WiFi thermostat - source code - ESP8266</h2><hr>
<pre><code>
/*|----------------------------------------------------------|*/
/*|HTTP webserver - WiFi thermostat - ESP8266 + DS18B20      |*/
/*|AUTHOR: Martin Chlebovec                                  |*/
/*|EMAIL: martinius96@gmail.com                              |*/
/*|DONATE: paypal.me/chlebovec                               |*/
/*|----------------------------------------------------------|*/

#include &lt;ESP8266WiFi.h>
#include &lt;ESP8266WebServer.h>
#include &lt;WiFiManager.h>
ESP8266WebServer server(80);
#include &lt;DNSServer.h>
#include &lt;EEPROM.h>
#include &lt;OneWire.h>
#include &lt;DallasTemperature.h>

#define ONE_WIRE_BUS 5 //D1
OneWire oneWire(ONE_WIRE_BUS);
DallasTemperature sensorsA(&oneWire);
const int rele = 4; //D2
unsigned long cas = 0;
String stav = "OFF";
float teplota;
long day = 86400000; // 86400000 milliseconds in a day
long hour = 3600000; // 3600000 milliseconds in an hour
long minute = 60000; // 60000 milliseconds in a minute
long second =  1000; // 1000 milliseconds in a second
float rezim;
boolean isFloat(String tString) {
  String tBuf;
  boolean decPt = false;

  if (tString.charAt(0) == '+' || tString.charAt(0) == '-') tBuf = &tString[1];
  else tBuf = tString;

  for (int x = 0; x &lt; tBuf.length(); x++)
  {
    if (tBuf.charAt(x) == '.' || tBuf.charAt(x) == ',') {
      if (decPt) return false;
      else decPt = true;
    }
    else if (tBuf.charAt(x) &lt; '0' || tBuf.charAt(x) > '9') return false;
  }
  return true;
}

void writeString(char add, float data)
{
  EEPROM.put(add, (data * 1000));
  EEPROM.commit();
}


float read_String(char add)
{
  float payload = 0;
  float data = EEPROM.get(add, payload);
  return (data / 1000);
}

void handleRoot() {
  int days = millis() / day ;                                //number of days
  unsigned int hours = (millis() % day) / hour;                       //the remainder from days division (in milliseconds) divided by hours, this gives the full hours
  unsigned int minutes = ((millis() % day) % hour) / minute ;         //and so on...
  unsigned int seconds = (((millis() % day) % hour) % minute) / second;
  String stranka = F("&lt;!DOCTYPE html>");
  stranka += F("&lt;html>");
  stranka += F("&lt;head>");
  stranka += F("&lt;meta charset='utf-8'>");
  stranka += F("&lt;meta name='author' content='Martin Chlebovec'>");
  stranka += F("&lt;meta http-equiv='Refresh' content='30'; />");
  stranka += F("&lt;meta name='viewport' content='width=device-width, initial-scale=1'>");
  stranka += F("&lt;link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css'>");
  stranka += F("&lt;script type='text/javascript'>");
  stranka += F("var timeleft = 30;");
  stranka += F("var downloadTimer = setInterval(function(){");
  stranka += F("if(timeleft &lt;= 0){");
  stranka += F("clearInterval(downloadTimer);");
  stranka += F("document.getElementById(\"countdown\").innerHTML = \"Refreshing...\";");
  stranka += F("} else {");
  stranka += F("document.getElementById(\"countdown\").innerHTML = timeleft + \" seconds to refresh\";");
  stranka += F("}");
  stranka += F("timeleft -= 1;");
  stranka += F("}, 1000);");
  stranka += F("&lt;/script>");
  stranka += F("&lt;title>WiFi thermostat - ESP8266&lt;/title>");
  stranka += F("&lt;/head>");
  stranka += F("&lt;body>");
  stranka += F("&lt;center>&lt;h3>WiFi thermostat - ESP8266:&lt;/h3>");
  if (rezim == 0.00) {
    stranka += F("&lt;form action='/action.html' method='post'>");
    stranka += "&lt;b>Target temperature:&lt;/b>&lt;br>&lt;input type='text' id='fname' name='fname' min='5' max='50' step='0.25' value=" + String(read_String(10)) + ">&lt;br>";
    stranka += "&lt;b>Hysteresis:&lt;/b>&lt;br>&lt;input type='text' id='fname2' name='fname2' min='0' max='10' step='0.25' value=" + String(read_String(100)) + ">&lt;br>";
    stranka += F("&lt;input type='submit' class='btn btn-success' value='Send'>");
    stranka += F("&lt;/form>");
    stranka += F("&lt;a href='manual.html' class='btn btn-primary' role='button'>Manual mode&lt;/a>&lt;hr>");
  } else if (rezim == 1.00) {
    if (stav == "ON") {
      stranka += F("&lt;a href='vyp.html' class='btn btn-danger' role='button'>Turn off&lt;/a>&lt;br>");
    }
    if (stav == "OFF") {
      stranka += F("&lt;a href='zap.html' class='btn btn-success' role='button'>Turn on&lt;/a>&lt;br>");
    }
    stranka += F("&lt;a href='automat.html' class='btn btn-primary' role='button'>Automatic mode&lt;/a>&lt;hr>");
  }
  if (stav == "ON") {
    stranka += F("&lt;b>&lt;font color='green'>Output: ON&lt;/font>&lt;/b>");
  }
  if (stav == "OFF") {
    stranka += F("&lt;b>&lt;font color='red'>Output: OFF&lt;/font>&lt;/b>");
  }
  stranka += F("&lt;div id=\"countdown\">&lt;/div>");
  stranka += F("&lt;b>Current sensor DS18B20 temperature:&lt;/b> ");
  stranka += String(teplota);
  stranka += F(" °C");
  stranka += F("&lt;hr>");
  stranka += F("&lt;b>Uptime: &lt;/b>");
  stranka += String(days);
  stranka += F("d");
  stranka += F(" ");
  stranka += String(hours);
  stranka += F("h");
  stranka += F(" ");
  stranka += String(minutes);
  stranka += F("m");
  stranka += F(" ");
  stranka += String(seconds);
  stranka += F("s");
  stranka += F("&lt;h3>Author: Martin Chlebovec - martinius96@gmail.com - https://martinius96.github.io/WiFi-termostat/en/&lt;/h3>");
  stranka += F("&lt;h4>Free version - 1.0.4 build: 06. Oct. 2021&lt;/h4>");
  stranka += F("&lt;/center>");
  stranka += F("&lt;/body>");
  stranka += F("&lt;/html>");
  server.send(200, "text/html", stranka);
}

void handleBody() {
  if (server.hasArg("fname")) {
    String target_temp = server.arg("fname");
    // float cielova_teplota = target_temp.toFloat();

    if (isFloat(target_temp)) {
      float cielova_teplota = target_temp.toFloat();
      writeString(10, cielova_teplota);
    } else {
      Serial.println(F("No number was entered in the input according to the target temperature!"));
      Serial.println(F("Writing into EEPROM prohibited!"));
    }
  }
  if (server.hasArg("fname2")) {
    String hysteresis = server.arg("fname2");
    if (isFloat(hysteresis)) {
      float hystereza = hysteresis.toFloat();
      writeString(100, hystereza);
    } else {
      Serial.println(F("No number was entered in the input according to the hysteresis!"));
      Serial.println(F("Writing into EEPROM prohibited!"));
    }
  }
  String stranka = F("&lt;!DOCTYPE html>");
  stranka += F("&lt;html>");
  stranka += F("&lt;head>");
  stranka += F("&lt;meta charset='utf-8'>");
  stranka += F("&lt;meta http-equiv='Refresh' content='5; url=/' />");
  stranka += F("&lt;title>WiFi thermostat - ESP8266 - data processing&lt;/title>");
  stranka += F("&lt;/head>");
  stranka += F("&lt;body>");
  stranka += F("&lt;center>&lt;h3>Server received data from HTML form:&lt;/h3>");
  stranka += "&lt;li>&lt;b>Target temperature: &lt;/b>" + String(read_String(10)) + " °C&lt;/li>";
  stranka += "&lt;li>&lt;b>Hysteresis: &lt;/b>" + String(read_String(100)) + " °C&lt;/li>";
  stranka += F("&lt;b>Redirecting... Please wait&lt;/b>&lt;/center>");
  stranka += F("&lt;/body>");
  stranka += F("&lt;/html>");
  server.send(200, "text/html", stranka);
}

void handleGet() {
  String stranka = "{\n";
  stranka += F("\"Hysteresis\":");
  stranka += String(read_String(100));
  stranka += F(",\n");
  stranka += F("\"Target_Temperature\":");
  stranka += String(read_String(10));
  stranka += F(",\n");
  stranka += F("\"Actual_Temperature\":");
  stranka += String(teplota) + "\n";
  stranka += F("}\n");
  server.send(200, "application/json", stranka);
}

void handleZAP() {
  stav = "ON";
  digitalWrite(rele, LOW);
  String stranka = F("&lt;!DOCTYPE html>");
  stranka += F("&lt;html>");
  stranka += F("&lt;head>");
  stranka += F("&lt;meta charset='utf-8'>");
  stranka += F("&lt;meta http-equiv='Refresh' content='0; url=/' />");
  stranka += F("&lt;/head>");
  stranka += F("&lt;/html>");
  server.send(200, "text/html", stranka);
}

void handleAuto() {
  writeString(150, 0.00);
  rezim = read_String(150);
  String stranka = F("&lt;!DOCTYPE html>");
  stranka += F("&lt;html>");
  stranka += F("&lt;head>");
  stranka += F("&lt;meta charset='utf-8'>");
  stranka += F("&lt;meta http-equiv='Refresh' content='0; url=/' />");
  stranka += F("&lt;/head>");
  stranka += F("&lt;/html>");
  server.send(200, "text/html", stranka);
}
void handleManual() {
  writeString(150, 1.00);
  rezim = read_String(150);
  String stranka = F("&lt;!DOCTYPE html>");
  stranka += F("&lt;html>");
  stranka += F("&lt;head>");
  stranka += F("&lt;meta charset='utf-8'>");
  stranka += F("&lt;meta http-equiv='Refresh' content='0; url=/' />");
  stranka += F("&lt;/head>");
  stranka += F("&lt;/html>");
  server.send(200, "text/html", stranka);
}
void handleVYP() {
  stav = "OFF";
  digitalWrite(rele, HIGH);
  String stranka = F("&lt;!DOCTYPE html>");
  stranka += F("&lt;html>");
  stranka += F("&lt;head>");
  stranka += F("&lt;meta charset='utf-8'>");
  stranka += F("&lt;meta http-equiv='Refresh' content='0; url=/' />");
  stranka += F("&lt;/head>");
  stranka += F("&lt;/html>");
  server.send(200, "text/html", stranka);
}
void setup() {
  Serial.begin(115200);
  WiFiManager wifiManager;
  wifiManager.autoConnect("WiFi_TERMOSTAT_AP");
  EEPROM.begin(512);  //Initialize EEPROM
  float a = read_String(10);
  float b = read_String(100);
  float c = read_String(150);
  if (isnan(a)) {
    writeString(10, 20.25);
  }
  if (isnan(b)) {
    writeString(100, 0.25);
  }
  if (isnan(c)) {
    writeString(150, 0.00);
  }
  sensorsA.begin();
  pinMode(rele, OUTPUT);
  digitalWrite(rele, HIGH);
  sensorsA.requestTemperatures();
  delay(750);
  Serial.println(F("WiFi thermostat - Author: Martin Chlebovec"));
  Serial.println("");
  Serial.println(F("WiFi connected."));
  Serial.println(F("IP address: "));
  Serial.println(WiFi.localIP());
  server.on("/", handleRoot);
  server.on("/get_data.json", handleGet);
  server.on("/automat.html", handleAuto);
  server.on("/manual.html", handleManual);
  server.on("/zap.html", handleZAP);
  server.on("/vyp.html", handleVYP);
  server.on("/action.html", HTTP_POST, handleBody);
  server.begin();
}

void loop() {
  if ((millis() - cas) >= 10000 || cas == 0) {
    cas = millis();
    teplota = sensorsA.getTempCByIndex(0);
    Serial.println();
    Serial.println(F("----------------------------------------------"));
    Serial.print(F("IP address of ESP8266 thermostat: "));
    Serial.print(WiFi.localIP());
    Serial.print(F(", for access via mDNS use http://"));
    Serial.print(WiFi.localIP());
    Serial.println(F("/"));
    Serial.print(F("Free HEAP: "));
    Serial.print(ESP.getFreeHeap());
    Serial.println(F(" B"));
    Serial.print(F("Actual DS18B20 temperature: "));
    Serial.print(String(teplota));
    Serial.println(F(" °C"));
    sensorsA.requestTemperatures();
    rezim = read_String(150);
    if (rezim == 0.00) {
      float cielova_teplota = read_String(10);
      float  hystereza = read_String(100);
      float minus_hystereza_teplota = (-1 * hystereza);
      float rozdiel = cielova_teplota - teplota; //21 - 20
      if (rozdiel > hystereza) {
        Serial.println(F("Output ON"));
        stav = "ON";
        digitalWrite(rele, LOW);
      } else if (rozdiel &lt; minus_hystereza_teplota) {
        Serial.println(F("Output OFF"));
        stav = "OFF";
        digitalWrite(rele, HIGH);
      } else {
        Serial.println(F("Difference between the target and actual temperature is not above or below the hysteresis. The output status does not change."));
        Serial.print(F("Actual output state: "));
        Serial.println(stav);
      }
    } else {
      Serial.print(F("Manual operation mode is used, output status: "));
      Serial.println(stav);
    }
  }
  server.handleClient();
  yield();
}
</code>
</pre>

<hr><h2>WiFi thermostat - source code - ESP32</h2><hr>
<pre><code>
/*|----------------------------------------------------------|*/
/*|HTTP webserver - WiFi thermostat - ESP32 + DS18B20        |*/
/*|AUTHOR: Martin Chlebovec                                  |*/
/*|EMAIL: martinius96@gmail.com                              |*/
/*|DONATE: paypal.me/chlebovec                               |*/
/*|Arduino Core 2.0.7 (August 2022)                          |*/
/*|----------------------------------------------------------|*/

#include &lt;WiFi.h>
#include &lt;WebServer.h>
#include &lt;WiFiManager.h>
#include &lt;ESPmDNS.h>
WebServer server(80);
#include &lt;EEPROM.h>
#include &lt;OneWire.h>
#include &lt;DallasTemperature.h>

#define ONE_WIRE_BUS 23
OneWire oneWire(ONE_WIRE_BUS);
DallasTemperature sensorsA(&oneWire);
const int rele = 22; //D2
unsigned long cas = 0;
String stav = "OFF";
float teplota;
long day = 86400000; // 86400000 milliseconds in a day
long hour = 3600000; // 3600000 milliseconds in an hour
long minute = 60000; // 60000 milliseconds in a minute
long second =  1000; // 1000 milliseconds in a second

boolean isFloat(String tString) {
  String tBuf;
  boolean decPt = false;

  if (tString.charAt(0) == '+' || tString.charAt(0) == '-') tBuf = &tString[1];
  else tBuf = tString;

  for (int x = 0; x &lt; tBuf.length(); x++)
  {
    if (tBuf.charAt(x) == '.' || tBuf.charAt(x) == ',') {
      if (decPt) return false;
      else decPt = true;
    }
    else if (tBuf.charAt(x) &lt; '0' || tBuf.charAt(x) > '9') return false;
  }
  return true;
}

void writeString(char add, float data)
{
  EEPROM.put(add, (data * 1000));
  EEPROM.commit();
}


float read_String(char add)
{
  float payload = 0;
  float data = EEPROM.get(add, payload);
  return (data / 1000);
}

void handleRoot() {
  int days = millis() / day ;                                //number of days
  unsigned int hours = (millis() % day) / hour;                       //the remainder from days division (in milliseconds) divided by hours, this gives the full hours
  unsigned int minutes = ((millis() % day) % hour) / minute ;         //and so on...
  unsigned int seconds = (((millis() % day) % hour) % minute) / second;
  String stranka = F("&lt;!DOCTYPE html>");
  stranka += F("&lt;html>");
  stranka += F("&lt;head>");
  stranka += F("&lt;meta charset='utf-8'>");
  stranka += F("&lt;meta name='author' content='Martin Chlebovec'>");
  stranka += F("&lt;meta http-equiv='Refresh' content='30'; />");
  stranka += F("&lt;meta name='viewport' content='width=device-width, initial-scale=1'>");
  stranka += F("&lt;link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css'>");
  stranka += F("&lt;script type='text/javascript'>");
  stranka += F("var timeleft = 30;");
  stranka += F("var downloadTimer = setInterval(function(){");
  stranka += F("if(timeleft &lt;= 0){");
  stranka += F("clearInterval(downloadTimer);");
  stranka += F("document.getElementById(\"countdown\").innerHTML = \"Refreshing...\";");
  stranka += F("} else {");
  stranka += F("document.getElementById(\"countdown\").innerHTML = timeleft + \" seconds to refresh\";");
  stranka += F("}");
  stranka += F("timeleft -= 1;");
  stranka += F("}, 1000);");
  stranka += F("&lt;/script>");
  stranka += F("&lt;title>WiFi thermostat - ESP32&lt;/title>");
  stranka += F("&lt;/head>");
  stranka += F("&lt;body>");
  stranka += F("&lt;center>&lt;h3>Enter datas for web server:&lt;/h3>");
  stranka += F("&lt;form action='/action.html' method='post'>");
  stranka += "&lt;b>Target temperature:&lt;/b>&lt;br>&lt;input type='text' id='fname' name='fname' min='5' max='50' step='0.25' value=" + String(read_String(10)) + ">&lt;br>";
  stranka += "&lt;b>Hysteresis:&lt;/b>&lt;br>&lt;input type='text' id='fname2' name='fname2' min='0' max='10' step='0.25' value=" + String(read_String(100)) + ">&lt;br>";
  stranka += F("&lt;input type='submit' class='btn btn-success' value='Send'>");
  stranka += F("&lt;/form>&lt;hr>");
  if (stav == "ON") {
    stranka += F("&lt;b>&lt;font color='green'>Output: ON&lt;/font>&lt;/b>");
  }
  if (stav == "OFF") {
    stranka += F("&lt;b>&lt;font color='red'>Output: OFF&lt;/font>&lt;/b>");
  }
  stranka += F("&lt;div id=\"countdown\">&lt;/div>");
  stranka += F("&lt;b>Current sensor DS18B20 temperature:&lt;/b> ");
  stranka += String(teplota);
  stranka += F(" °C");
  stranka += F("&lt;hr>");
  stranka += F("&lt;b>Uptime: &lt;/b>");
  stranka += String(days);
  stranka += F("d");
  stranka += F(" ");
  stranka += String(hours);
  stranka += F("h");
  stranka += F(" ");
  stranka += String(minutes);
  stranka += F("m");
  stranka += F(" ");
  stranka += String(seconds);
  stranka += F("s");
  stranka += F("&lt;h3>Author: Martin Chlebovec - martinius96@gmail.com - https://martinius96.github.io/WiFi-termostat/en/&lt;/h3>");
  stranka += F("&lt;h4>Free version - 1.0.4 build: 10. Oct. 2021&lt;/h4>");
  stranka += F("&lt;/center>");
  stranka += F("&lt;/body>");
  stranka += F("&lt;/html>");
  server.send(200, "text/html", stranka);
}

void handleBody() {
  if (server.hasArg("fname")) {
    String target_temp = server.arg("fname");
    // float cielova_teplota = target_temp.toFloat();

    if (isFloat(target_temp)) {
      float cielova_teplota = target_temp.toFloat();
      writeString(10, cielova_teplota);
    } else {
      Serial.println(F("No number was entered in the target temperature input field!"));
      Serial.println(F("Datas will be not stored in EEPROM!"));
    }
  }
  if (server.hasArg("fname2")) {
    String hysteresis = server.arg("fname2");
    if (isFloat(hysteresis)) {
      float hystereza = hysteresis.toFloat();
      writeString(100, hystereza);
    } else {
      Serial.println(F("No number was entered in the hysteresis input field!"));
      Serial.println(F("Datas will be not stored in EEPROM!"));
    }
  }
  String stranka = F("&lt;!DOCTYPE html>");
  stranka += F("&lt;html>");
  stranka += F("&lt;head>");
  stranka += F("&lt;meta charset='utf-8'>");
  stranka += F("&lt;meta http-equiv='Refresh' content='5; url=/' />");
  stranka += F("&lt;title>WiFi thermostat - ESP32 - data processing&lt;/title>");
  stranka += F("&lt;/head>");
  stranka += F("&lt;body>");
  stranka += F("&lt;center>&lt;h3>Server received datas from HTML form:&lt;/h3>");
  stranka += "&lt;li>&lt;b>Target temperature: &lt;/b>" + String(read_String(10)) + " °C&lt;/li>";
  stranka += "&lt;li>&lt;b>Hysteresis: &lt;/b>" + String(read_String(100)) + " °C&lt;/li>";
  stranka += F("&lt;b>Redirecting... Please wait&lt;/b>&lt;/center>");
  stranka += F("&lt;/body>");
  stranka += F("&lt;/html>");
  server.send(200, "text/html", stranka);
}

void handleGet() {
  String stranka = "{\n";
  stranka += F("\"Hysteresis\":");
  stranka += String(read_String(100));
  stranka += F(",\n");
  stranka += F("\"Target_Temperature\":");
  stranka += String(read_String(10));
  stranka += F(",\n");
  stranka += F("\"Actual_Temperature\":");
  stranka += String(teplota) + "\n";
  stranka += F("}\n");
  server.send(200, "application/json", stranka);
}

void setup() {
  Serial.begin(115200);
  WiFiManager wifiManager;
  wifiManager.autoConnect("WiFi_TERMOSTAT_AP");
  EEPROM.begin(512);  //Initialize EEPROM
  float a = read_String(10);
  float b = read_String(100);
  if (isnan(a)) {
    writeString(10, 20.25);
  }
  if (isnan(b)) {
    writeString(100, 0.25);
  }
  sensorsA.begin();
  pinMode(rele, OUTPUT);
  digitalWrite(rele, HIGH);
  sensorsA.requestTemperatures();
  delay(750);
  Serial.println(F("Webapp created by: Martin Chlebovec"));
  Serial.println(F("Build 1.0.4 from 10. Oct 2021"));
  Serial.println(F("WiFi connected."));
  Serial.println(F("IP address of WiFi thermostat: "));
  Serial.println(WiFi.localIP());
  if (!MDNS.begin("wifi-termostat")) {
    Serial.println("Error setting up MDNS responder!");
    while (1) {
      delay(1000);
    }
  }
  Serial.println("mDNS responder running");
  Serial.println(F("Thermostat available at: http://wifi-termostat.local"));
  server.on("/", handleRoot);
  server.on("/get_data.json", handleGet);
  server.on("/action.html", HTTP_POST, handleBody);
  server.begin();
  MDNS.addService("http", "tcp", 80);
}

void loop() {
  if ((millis() - cas) >= 10000 || cas == 0) {
    cas = millis();
    teplota = sensorsA.getTempCByIndex(0);
    Serial.println();
    Serial.println(F("----------------------------------------------"));
    Serial.print(F("IP address of WiFi Thermostat: "));
    Serial.print(WiFi.localIP());
    Serial.print(F(", to access WiFi thermostat, visit http://"));
    Serial.print(WiFi.localIP());
    Serial.println(F("/"));
    Serial.println(F("Thermostat also available at: http://wifi-termostat.local via mDNS record"));
    Serial.print(F("Free HEAP: "));
    Serial.print(ESP.getFreeHeap());
    Serial.println(F(" B"));
    Serial.print(F("Current temperature: "));
    Serial.print(String(teplota));
    Serial.println(F(" °C"));
    sensorsA.requestTemperatures();
    float cielova_teplota = read_String(10);
    float  hystereza = read_String(100);
    float minus_hystereza_teplota = (-1 * hystereza);
    float rozdiel = cielova_teplota - teplota; //21 - 20
    if (rozdiel > hystereza) {
      Serial.println(F("Output on"));
      stav = "ON";
      digitalWrite(rele, LOW);
    } else if (rozdiel &lt; minus_hystereza_teplota) {
      Serial.println(F("Output off"));
      stav = "OFF";
      digitalWrite(rele, HIGH);
    } else {
      Serial.println(F("Difference between target and actual temp is not above or below the hysteresis. The output state does not change."));
      Serial.print(F("Actual state of output: "));
      Serial.println(stav);
    }
  }
  server.handleClient();
  yield();
}
</code>
</pre>
</div>
</div>
</div>
</body>
        <script>
$(document).ready(function(){
  $('[data-toggle="tooltip2"]').tooltip();   
});
</script>
</html>
